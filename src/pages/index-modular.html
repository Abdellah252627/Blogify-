<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blogify</title>
    
    <!-- Modular CSS Files -->
    <link rel="stylesheet" href="../styles/variables.css">
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/components.css">
    <link rel="stylesheet" href="../styles/layout.css">
    <link rel="stylesheet" href="../styles/skeleton.css">
    <link rel="stylesheet" href="../styles/rich-editor.css">
</head>
<body>

    <header>
        <div class="progress-bar" id="progress-bar"></div>
        <div class="logo" data-lang-key="logo">Blogify üìù</div>
        <nav>
             <button class="btn btn-secondary" id="about-btn" data-lang-key="about" aria-label="About Blogify">About</button>
             <button class="btn btn-secondary" id="bookmarks-btn" data-lang-key="bookmarks" aria-label="View Bookmarks">Bookmarks</button>
        </nav>
        <div class="controls">
            <button class="btn" id="new-article-btn" data-lang-key="new_article" aria-label="Create new article">New Article</button>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" id="tools-menu-btn" aria-label="Tools menu" aria-expanded="false" aria-haspopup="true">üõ†Ô∏è Tools</button>
                <div class="dropdown-menu" id="tools-menu" role="menu" aria-labelledby="tools-menu-btn">
                    <button class="dropdown-item" id="export-btn" data-lang-key="export_articles" role="menuitem">Export Articles</button>
                    <button class="dropdown-item" id="import-btn" data-lang-key="import_articles" role="menuitem">Import Articles</button>
                    <button class="dropdown-item" id="rss-feed-btn" data-lang-key="rss_feed" role="menuitem">RSS Feed</button>
                    <button class="dropdown-item" id="analytics-btn" data-lang-key="analytics" role="menuitem">Analytics</button>
                </div>
            </div>
            <button class="btn btn-secondary" id="user-profile-btn" aria-label="User profile">üë§</button>
            <button class="btn btn-secondary" id="theme-toggle-btn" aria-label="Toggle theme">üåô</button>
            <button class="btn btn-secondary" id="lang-toggle-btn" aria-label="Toggle language">ÿπ</button>
        </div>
    </header>

    <main class="container">
        <!-- Home Page -->
        <section id="home-page" class="page active">
            <div class="page-header">
                <h2 data-lang-key="recent_articles">Recent Articles</h2>
                <div class="search-controls">
                    <input type="text" id="search-input" placeholder="Search articles..." data-lang-key="search_placeholder" aria-label="Search articles">
                    <select id="category-filter" aria-label="Filter by category">
                        <option value="" data-lang-key="all_categories">All Categories</option>
                    </select>
                </div>
            </div>
            <div class="tag-cloud" id="tag-cloud">
                <!-- Tags will be injected here -->
            </div>
            <div id="articles-grid">
                <!-- Articles will be injected here -->
            </div>
        </section>

        <!-- Editor Page -->
        <section id="editor-page" class="page">
            <h2 data-lang-key="write_article">Write a New Article</h2>
            <form id="article-form">
                <div class="form-group">
                    <label for="article-title" data-lang-key="title">Title</label>
                    <input type="text" id="article-title" required>
                </div>
                <div class="form-group">
                    <label for="article-category" data-lang-key="category">Category</label>
                    <input type="text" id="article-category" placeholder="e.g., Technology, Lifestyle..." data-lang-key="category_placeholder">
                </div>
                <div class="form-group">
                    <label for="article-tags" data-lang-key="tags">Tags</label>
                    <input type="text" id="article-tags" placeholder="e.g., web, javascript, tutorial (comma separated)" data-lang-key="tags_placeholder">
                </div>
                <div class="form-group">
                    <label for="article-content" data-lang-key="content">Content</label>
                    <div class="editor-container">
                        <!-- Rich Editor will be initialized here -->
                    </div>
                    <div class="editor-stats">
                        <span id="word-count">0 words</span>
                        <span id="char-count">0 characters</span>
                        <span id="reading-time">0 min read</span>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="save-draft-btn" data-lang-key="save_draft">Save Draft</button>
                    <button type="submit" class="btn" id="publish-btn" data-lang-key="publish">Publish</button>
                </div>
            </form>
        </section>

        <!-- Article Detail Page -->
        <section id="article-detail-page" class="page">
            <div class="article-detail">
                <button class="btn btn-secondary back-btn" data-lang-key="back" aria-label="Back to articles">‚Üê Back</button>
                <div class="article-actions-bar">
                    <div class="reading-time" id="reading-time" aria-live="polite"></div>
                    <div class="share-actions">
                        <button class="btn-icon share-btn" title="Share" aria-label="Share article">üì§</button>
                        <button class="btn-icon print-btn" title="Print" aria-label="Print article">üñ®Ô∏è</button>
                    </div>
                </div>
                <article id="article-content-detail">
                    <!-- Article content will be injected here -->
                </article>

                <!-- Related Articles Section -->
                <section class="related-articles-section">
                    <h3 data-lang-key="related_articles">Related Articles</h3>
                    <div id="related-articles-grid" class="related-articles-grid">
                        <!-- Related articles will be injected here -->
                    </div>
                </section>
            </div>
        </section>

        <!-- Bookmarks Page -->
        <section id="bookmarks-page" class="page">
            <div class="page-header">
                <h2 data-lang-key="bookmarked_articles">Bookmarked Articles</h2>
            </div>
            <div id="bookmarked-articles-grid">
                <!-- Bookmarked articles will be injected here -->
            </div>
        </section>

        <!-- Keyboard Shortcuts Modal -->
        <div id="shortcuts-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-lang-key="keyboard_shortcuts">Keyboard Shortcuts</h3>
                    <button class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>N</kbd>
                        <span data-lang-key="shortcut_new_article">New Article</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>F</kbd>
                        <span data-lang-key="shortcut_search">Focus Search</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>S</kbd>
                        <span data-lang-key="shortcut_save">Save Draft</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>Enter</kbd>
                        <span data-lang-key="shortcut_publish">Publish Article</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd>
                        <span data-lang-key="shortcut_escape">Close/Cancel</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>?</kbd>
                        <span data-lang-key="shortcut_help">Show Shortcuts</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Page -->
        <section id="about-page" class="page">
            <h2 data-lang-key="about_title">About Blogify</h2>
            <p data-lang-key="about_text">Blogify is a modern, interactive, and professional blogging platform. It supports both light and dark modes, language switching (Arabic/English) with animations, and local storage for your articles. This project is built with pure HTML, CSS, and JavaScript to be lightweight and fast.</p>
        </section>

        <!-- User Profile Page -->
        <section id="user-profile-page" class="page">
            <div class="profile-header">
                <button class="btn btn-secondary back-btn" data-lang-key="back" aria-label="Back to home">‚Üê Back</button>
                <h2 data-lang-key="user_profile">User Profile</h2>
            </div>
            <div class="profile-content">
                <div class="profile-card">
                    <div class="profile-avatar">
                        <img id="profile-avatar-img" src="https://picsum.photos/seed/avatar/150/150.jpg" alt="User profile avatar">
                        <button class="btn-icon change-avatar-btn" title="Change Avatar" aria-label="Change profile avatar">üì∑</button>
                    </div>
                    <div class="profile-info">
                        <h3 id="profile-display-name">John Doe</h3>
                        <p id="profile-bio">Passionate blogger and writer</p>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span id="profile-articles-count">0</span>
                                <span data-lang-key="articles">Articles</span>
                            </div>
                            <div class="stat-item">
                                <span id="profile-views-count">0</span>
                                <span data-lang-key="views">Views</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-form">
                    <h3 data-lang-key="edit_profile">Edit Profile</h3>
                    <form id="profile-form">
                        <div class="form-group">
                            <label for="profile-name" data-lang-key="name">Name</label>
                            <input type="text" id="profile-name" required>
                        </div>
                        <div class="form-group">
                            <label for="profile-email" data-lang-key="email">Email</label>
                            <input type="email" id="profile-email">
                        </div>
                        <div class="form-group">
                            <label for="profile-bio-input" data-lang-key="bio">Bio</label>
                            <textarea id="profile-bio-input" rows="3"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn" data-lang-key="save_profile">Save Profile</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Analytics Dashboard Page -->
        <section id="analytics-page" class="page">
            <div class="analytics-header">
                <button class="btn btn-secondary back-btn" data-lang-key="back" aria-label="Back to home">‚Üê Back</button>
                <h2 data-lang-key="analytics_dashboard">Analytics Dashboard</h2>
            </div>
            <div class="analytics-content">
                <div class="analytics-overview">
                    <div class="stat-card">
                        <h3 data-lang-key="total_articles">Total Articles</h3>
                        <div class="stat-value" id="total-articles">0</div>
                    </div>
                    <div class="stat-card">
                        <h3 data-lang-key="total_views">Total Views</h3>
                        <div class="stat-value" id="total-views">0</div>
                    </div>
                    <div class="stat-card">
                        <h3 data-lang-key="total_comments">Total Comments</h3>
                        <div class="stat-value" id="total-comments">0</div>
                    </div>
                    <div class="stat-card">
                        <h3 data-lang-key="avg_reading_time">Avg Reading Time</h3>
                        <div class="stat-value" id="avg-reading-time">0 min</div>
                    </div>
                </div>
                <div class="analytics-charts">
                    <div class="chart-container">
                        <h3 data-lang-key="views_by_category">Views by Category</h3>
                        <canvas id="category-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 data-lang-key="popular_articles">Popular Articles</h3>
                        <div id="popular-articles-list"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-lang-key="confirm_delete_title">Confirm Deletion</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p data-lang-key="confirm_delete_text">Are you sure you want to delete this article? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-delete-btn" data-lang-key="cancel">Cancel</button>
                <button class="btn btn-danger" id="confirm-delete-btn" data-lang-key="delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Comments Modal -->
    <div id="comments-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 data-lang-key="comments">Comments</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="comments-section">
                    <div id="comments-list">
                        <!-- Comments will be injected here -->
                    </div>
                    <div class="comment-form">
                        <h4 data-lang-key="add_comment">Add Comment</h4>
                        <form id="comment-form">
                            <div class="form-group">
                                <label for="comment-author" data-lang-key="name">Name</label>
                                <input type="text" id="comment-author" required>
                            </div>
                            <div class="form-group">
                                <label for="comment-email" data-lang-key="email">Email</label>
                                <input type="email" id="comment-email">
                            </div>
                            <div class="form-group">
                                <label for="comment-content" data-lang-key="comment">Comment</label>
                                <textarea id="comment-content" rows="3" required></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn" data-lang-key="submit_comment">Submit Comment</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import/Export Modal -->
    <div id="import-export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="import-export-title" data-lang-key="export_articles">Export Articles</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="export-section">
                    <p data-lang-key="export_description">Export all your articles as a JSON file for backup or migration.</p>
                    <div class="form-actions">
                        <button class="btn" id="confirm-export-btn" data-lang-key="download_export">Download Export</button>
                    </div>
                </div>
                <div id="import-section" style="display: none;">
                    <p data-lang-key="import_description">Import articles from a JSON file. Note: This will merge with existing articles.</p>
                    <div class="form-group">
                        <label for="import-file" data-lang-key="select_file">Select File</label>
                        <input type="file" id="import-file" accept=".json" required>
                    </div>
                    <div class="form-actions">
                        <button class="btn" id="confirm-import-btn" data-lang-key="import_articles">Import Articles</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RSS Feed Modal -->
    <div id="rss-feed-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-lang-key="rss_feed">RSS Feed</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="rss-feed">
                    <h4 data-lang-key="rss_feed_title">RSS Feed</h4>
                    <div id="rss-feed-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Link Modal -->
    <div id="link-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-lang-key="add_link">Add Link</h3>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="link-url" data-lang-key="link_url">URL</label>
                    <input type="url" id="link-url" placeholder="https://example.com" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-link-btn" data-lang-key="cancel">Cancel</button>
                <button class="btn" id="confirm-link-btn" data-lang-key="add_link">Add Link</button>
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button id="back-to-top-btn" class="btn btn-secondary" title="Go to top" aria-label="Go to top">
        ‚Üë
    </button>

    <!-- Performance Stats Display -->
    <div id="performance-stats" style="display: none;">
        <h4>Performance Stats</h4>
        <div class="perf-item">
            <span>Articles Loaded:</span>
            <span id="articles-loaded-count">0</span>
        </div>
        <div class="perf-item">
            <span>Images Loaded:</span>
            <span id="images-loaded-count">0</span>
        </div>
        <div class="perf-item">
            <span>Avg Load Time:</span>
            <span id="avg-load-time">0ms</span>
        </div>
        <div class="perf-item">
            <span>Memory Usage:</span>
            <span id="memory-usage">0MB</span>
        </div>
    </div>

    <!-- Chart.js with fallback -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" onerror="handleChartJSError()"></script>
    <script>
        function handleChartJSError() {
            console.warn('Chart.js failed to load from CDN - analytics charts will be disabled');
            createChartJSFallback();
        }
        
        function createChartJSFallback() {
            window.Chart = function(ctx, config) {
                if (ctx && ctx.canvas) {
                    ctx.canvas.style.display = 'none';
                    const parent = ctx.canvas.parentElement;
                    if (parent) {
                        const message = document.createElement('p');
                        message.textContent = 'Charts are not available - Chart.js failed to load';
                        message.style.textAlign = 'center';
                        message.style.color = '#6b7280';
                        parent.appendChild(message);
                    }
                }
                return {
                    destroy: () => {},
                    update: () => {},
                    render: () => {}
                };
            };
            window.Chart.register = () => {};
            window.Chart.defaults = { plugins: { legend: { display: true } } };
        }
        
        window.addEventListener('load', () => {
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js not available - creating fallback');
                createChartJSFallback();
            }
        });
    </script>

    <!-- Modular JavaScript Files -->
    <script type="module" src="../app.js"></script>
</body>
</html>
